{% extends "admin/change_form.html" %}
{% load i18n admin_urls static %}

{% block content %}
  {{ block.super }}

  {% if original %}
  <div class="module aligned" style="margin-top:24px;">
    <h2 style="margin-bottom:8px;">Evidencias del Trabajo (URL)</h2>
    <p class="help">Agrega enlaces (Drive/Dropbox, etc.). El archivo debe ser accesible con el enlace.</p>

    <form method="post" action="{% url 'workorders_add_evidence_admin' original.id %}" style="margin-bottom:16px;">
      {% csrf_token %}
      <input type="hidden" name="evid_admin-TOTAL_FORMS" value="1">
      <input type="hidden" name="evid_admin-INITIAL_FORMS" value="0">
      <input type="hidden" name="evid_admin-MIN_NUM_FORMS" value="0">
      <input type="hidden" name="evid_admin-MAX_NUM_FORMS" value="1000">

      <div class="inline-group">
        <div class="inline-related">
          <fieldset class="module aligned">
            <div class="form-row field-url">
              <div>
                <label>URL</label>
                <input type="url" name="evid_admin-0-url" placeholder="https://..." required>
              </div>
            </div>
            <div class="form-row field-description">
              <div>
                <label>Descripción</label>
                <input type="text" name="evid_admin-0-description" maxlength="200">
              </div>
            </div>
          </fieldset>
        </div>
      </div>

      <button class="button default" type="submit">Agregar evidencia</button>
    </form>

    {% if original.attachments.all %}
      <div class="inline-group">
        <h3>Evidencias registradas</h3>
        <ul>
        {% for att in original.attachments.all %}
          <li><a href="{{ att.url }}" target="_blank" rel="noopener">{{ att.url }}</a>{% if att.description %} — {{ att.description }}{% endif %}</li>
        {% endfor %}
        </ul>
      </div>
    {% else %}
      <div class="inline-group"><p style="padding:8px;">Sin evidencias aún.</p></div>
    {% endif %}
  </div>
  {% endif %}
{% endblock %}
