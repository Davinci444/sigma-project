<!-- templates/workorders/task_formset.html -->
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>OT #{{ ot.id }} – Tareas y Evidencias</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{--bg:#0b1324;--card:#101a34;--text:#e8eefc;--muted:#a9b7d9;--acc:#37d39a;--table:#0d1730}
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial}
    .wrap{max-width:1100px;margin:24px auto;padding:16px}
    h1{margin:0 0 6px}
    .muted{color:var(--muted);margin:0 0 16px}
    .card{background:var(--card);border-radius:16px;padding:16px;box-shadow:0 10px 20px rgba(0,0,0,.2)}
    .grid{display:grid;gap:16px}
    @media(min-width:920px){.grid.cols-2{grid-template-columns:2fr 1fr}}
    table{width:100%;border-collapse:collapse;background:var(--table);border-radius:12px;overflow:hidden}
    th,td{padding:10px;border-bottom:1px solid #1b2a52}
    th{text-align:left;font-weight:700}
    input,select,textarea{width:100%;padding:8px;border-radius:10px;border:1px solid #273253;background:#0d1730;color:var(--text)}
    .actions{display:flex;gap:12px;margin-top:14px}
    .btn{background:var(--acc);color:#04111c;border:none;padding:12px 16px;border-radius:12px;font-weight:700;cursor:pointer}
    a.link{color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>OT #{{ ot.id }} — {{ ot.get_order_type_display }} — {{ ot.vehicle }}</h1>
    <p class="muted">Agrega/edita los trabajos (categoría/subcategoría) y registra evidencias (URL seguras).</p>

    <form method="post">
      {% csrf_token %}
      <div class="grid cols-2 card">
        <div>
          <h2>Trabajos</h2>
          {{ formset.management_form }}
          <table>
            <thead>
              <tr>
                <th>Categoría</th>
                <th>Subcategoría</th>
                <th>Descripción</th>
                <th>Horas</th>
                <th>Tercero</th>
                <th>Tarifa</th>
                <th>Eliminar</th>
              </tr>
            </thead>
            <tbody>
              {% for form in formset %}
              <tr>
                <td>{{ form.category }}</td>
                <td>{{ form.subcategory }}</td>
                <td>{{ form.description }}</td>
                <td>{{ form.hours_spent }}</td>
                <td>{{ form.is_external }}</td>
                <td>{{ form.labor_rate }}</td>
                <td>{{ form.DELETE }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <div>
          <h2>Evidencias (URL)</h2>
          {{ evidset.management_form }}
          <table>
            <thead>
              <tr><th>URL</th><th>Descripción</th><th>Eliminar</th></tr>
            </thead>
            <tbody>
              {% for form in evidset %}
              <tr>
                <td>{{ form.url }}</td>
                <td>{{ form.description }}</td>
                <td>{{ form.DELETE }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

      <div class="actions">
        <button class="btn" type="submit">Guardar</button>
        <a class="link" href="/admin/">Ver en Admin</a>
      </div>
    </form>
  </div>
</body>
</html>
